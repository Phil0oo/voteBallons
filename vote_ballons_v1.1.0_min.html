
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ballon</title>
    <style>
.voteZones,.votesContainer{overflow:hidden;display:flex}#chrono,button{border-radius:1.25em}:root{--ballon_width:50px;--ballon_height:75px;--zoom:2;--gray:100%}.votesContainer{position:absolute;width:95%;height:95%;flex-direction:row;justify-content:center;margin:0;padding:0;background:#bee8fb;background:linear-gradient(0deg,#bee8fb 0,#9db3ff 65%,#9db3ff 100%)}.voteZones,.zone{margin:0;padding:0;height:100%;position:relative}.voteZones{width:100%;min-width:470px;flex:1 1 auto;flex-direction:row}.zone{flex:1 1 auto}#voting_zone{flex-grow:2.5}#keep_zone{box-shadow:10px 0 5px #bbffa380;background:#bbffa380}#bin_zone{box-shadow:-10px 0 5px #f036177a;background:#f036177a}.ballon{position:absolute;width:var(--ballon_width);height:var(--ballon_height);background-color:red;color:#fff;display:flex;align-items:center;justify-content:center;border-radius:50%;filter:drop-shadow(5px 5px 5px #0003);box-shadow:inset -3px -3px 7px #0005}#chrono,.compteur{background:#80aed7a6;position:absolute}.ballon img{width:80%;max-height:var(--ballon_width);filter:grayscale(var(--gray));pointer-events:none}.ballon.clicked{transform:scale(var(--zoom));z-index:10}.ballon.clicked:hover{cursor:none}.compteur{min-width:2em;height:2em;align-content:center;text-align:center;border-radius:1em;margin:1em;font-size:larger;color:#fff}.modal-content,button{align-content:center;text-align:center;font-size:large;color:#fff}.compteur::before{content:"üéà";filter:brightness(200%)}#chrono{padding:0 .5em;height:2.5em;align-content:center;text-align:center;margin:.6em auto;font-size:xx-large;color:#fff}#chrono::before{content:"‚è±"}#chrono::after{content:"‚è∏"}.pulse{animation:1s infinite pulse-anim;opacity:.5}@keyframes pulse-anim{0%{opacity:.5;transform:scale(.5)}50%{opacity:1;transform:scale(1.5)}100%{opacity:.5;transform:scale(1)}}.warning_color{animation:6s forwards warning_color-anim,1s infinite pulse-anim}@keyframes warning_color-anim{0%{color:gold}100%{color:#dc143c}}.modalsContainer{position:absolute;width:100%;height:100%;background:#bed3e65e;backdrop-filter:blur(2px);display:flex}.modal-content{width:90%;height:90%;background:#938ba6c7;margin:auto;border-radius:.6em}.modal-content p{white-space:pre-line}button{padding:.25em 1em;background:#80aed7;margin:.25em auto;border:3px solid #fff;box-shadow:inset 0 0 8px}.hide{display:none}</style>
</head>
<body>
    <div class="votesContainer" id="votesContainer">
     <div id="vote_zones" class="voteZones">
        <div id="keep_zone" class="zone">
            <div class="compteur"></div>
        </div>
        <div id="voting_zone" class="zone">
            <div class="compteur"></div>
        </div>
        <div id="bin_zone" class="zone">
            <div class="compteur"></div>
            <!--<div id="5" class="ballon">5</div>-->
        </div>
     </div>
     <div id="chrono">200s</div>
     <div class="modalsContainer" id="modalsContainer">
    </div>
    </div>
    <script>
        const mailReportTo="omg@incredible.org",moveTriggerX=15,Zones=[],zones=document.getElementById("vote_zones"),chrono={tps:0,el:document.getElementById("chrono"),start:"",pause:0,init:""},pick={},lesBallons=[];var storedBallons=[],voteId=localStorage.getItem("onGoingVote");class voteZone{constructor(o){this.id=o,Zones.push(this),this.pos=Zones.length-1,this.zone=document.getElementById(o+"_zone"),this.compteurEl=this.zone.getElementsByClassName("compteur")[0],this.votes=[]}add(o){return this.votes.push(o),this.compteurEl.innerHTML=this.votes.length,this.votes.length}remove(o){let e=this.votes.indexOf(o);return this.votes.splice(e,1),this.compteurEl.innerHTML=this.votes.length,this.votes.length}}const keep=new voteZone("keep"),voting=new voteZone("voting"),bin=new voteZone("bin");class Ballon{constructor(o,e="none",n=voting.zone){let t=localStorage.onGoingVote&&inStore(o);this.zoneId=t?.zoneId||n.id,this.zone=document?.getElementById(t?.zoneId)||n,this.id=o,this.x=t?.x||0,this.y=t?.y||0,this.v=t?.v||.25*Math.random()+.2,this.h=t?.h||0,this.ballonElement=document.createElement("div"),this.ballonElement.className="ballon",this.ballonElement.id=o,this.ballonElement.innerHTML="none"==e?o:`<img src="./${e}" alt="image ${e}" class="hide" onload="this.classList.remove('hide')"/>`,this.ballonElement.title=o,this.zone.appendChild(this.ballonElement),Zones.find((o=>o.id+"_zone"==this.zoneId)).add(this.id),this.positionBallon(t?.x,t?.y),this.setPastelColor(t?.color)}positionBallon(o="",e=""){const n=this.zone.getBoundingClientRect(),t=Math.floor(Math.random()*(n.width-this.ballonElement.offsetWidth)),l=Math.floor(Math.random()*(n.height-this.ballonElement.offsetHeight));let i=Math.floor(100*t/n.width),s=Math.floor(100*l/n.height);this.x=o||i,this.y=e||s,this.ballonElement.style.left=`${i}%`,this.ballonElement.style.top=`${s}%`}setPastelColor(o=""){this.color=o||generatePastelColor(),this.ballonElement.style.backgroundColor=this.color}}function generatePastelColor(){return`rgb(${Math.floor(128*Math.random()+127)}, ${Math.floor(128*Math.random()+127)}, ${Math.floor(128*Math.random()+127)})`}function clearSelection(){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}function handlePointerDown(o){o.stopPropagation(),theBallonEl=o.target.closest(".ballon"),theBallonEl?(theBallon=lesBallons.find((o=>o.id==theBallonEl.id)),theBallon.clicked=!0,pick.ballonId=theBallonEl.id,theZone=theBallonEl.closest(".zone"),pick.zoneId=theZone.id,pick.zonePos=Zones.findIndex((o=>o.id+"_zone"==pick.zoneId)),pick.initialX=o.clientX-theZone.offsetLeft,pick.endX=o.clientX-theZone.offsetLeft,console.log(`Ballon ${theBallonEl.id} clicked at position: ${pick.initialX}`,theBallonEl.getBoundingClientRect()),theBallonEl.classList.add("clicked")):(console.log("Clicked away from any Ballon"),pick.ballonId="")}function handlePointerUp(o){o.stopPropagation(),pick.ballonId?(theBallonEl=document.getElementById(pick.ballonId),theBallon=lesBallons.find((o=>o.id==pick.ballonId)),console.log(`Ballon ${theBallon.id} un-clicked`),theBallonEl.classList.remove("clicked"),pick.ballonId="",pick.endX="",pick.endY="",pick.zoneId="",pick.zonePos="",pick.initialX="",pick.previousX=""):console.log("Clicked away from any Ballon")}function handlePointerMove(o){if(o.stopPropagation(),clearSelection(),pick.ballonId){const e=document.getElementById(pick.ballonId);let n=lesBallons.find((o=>o.id==pick.ballonId)),t=pick.zonePos,l=pick.zonePos;theZone=e.closest(".zone"),console.log("zone:",l),pick.previousX=pick.endX,pick.endX=o.clientX-theZone.offsetLeft;const i=pick.endX-pick.initialX,s=pick.endX-pick.previousX;if(Math.abs(i)>15){i>0?(console.log("Pointer moved more than 10px to the right. Current position:",pick.endX),l=Math.min(pick.zonePos+1,Zones.length-1)):i<0&&(console.log("Pointer moved more than 10px to the left. Current position:",pick.endX),l=Math.max(pick.zonePos-1,0)),store(chrono.init),console.log(pick.zonePos,", ",i,", ",l),Zones[l].zone.appendChild(e);let o=Zones[t].remove(pick.ballonId);Zones[l].add(pick.ballonId),n.zone=Zones[l].zone,n.zoneId=Zones[l].zone.id;const s=new MouseEvent("pointerup",{view:window,bubbles:!0,cancelable:!0});e.dispatchEvent(s);0==o&&t==voting.pos&&endVoting()}else{let o=e.style.left,n=Zones[l].zone.getBoundingClientRect().width;o=o.includes("px")?parseInt(o,10):o.includes("%")?parseFloat(o,10)*n/100:o,o=Math.min(Math.max(o+s,0),n-e.offsetWidth),e.style.left=100*o/n+"%"}}}function moveBallon(o){const e=o.zone.getBoundingClientRect();o.ballonElement.classList.contains("clicked")||(o.y-=o.v,o.y<=0-o.ballonElement.offsetHeight/e.height*100&&(o.y=100+o.ballonElement.offsetHeight/e.height),o.ballonElement.style.top=`${o.y}%`)}function runVotes(o){if(!chrono.pause){chrono.start&&(chrono.lastds=o,chrono.start=!1);const e=(o-chrono.lastds)/1e3;if(chrono.lastds=o,e>0&&chrono.tps>0){let o=-Math.ceil(chrono.tps);chrono.runtime+=e,chrono.tps=Math.max(chrono.tps-e,0),o+=Math.ceil(chrono.tps),chrono.el.innerHTML=Math.ceil(chrono.tps)+"s",chrono.tps<=10&&!chrono.el.classList.contains("pulse")&&0!=o&&chrono.el.classList.add("pulse"),chrono.tps<=5&&!chrono.el.classList.contains("warning_color")&&0!=o&&chrono.el.classList.add("warning_color"),lesBallons.forEach((o=>moveBallon(o)))}if(0==chrono.tps)return void pauseVoting();requestAnimationFrame(runVotes)}}function pauseVoting(){chrono.pause=Date.now(),chrono.el.classList.remove("pulse","warning_color"),modal("relance")}function startVoting(o=2.5*lesBallons.length){chrono.tps=o,chrono.init=chrono.init||localStorage.onGoingVote||"",chrono.init||(chrono.init=store(),chrono.runtime=0);let e=JSON.parse(localStorage.getItem("chrono"+chrono.init));e&&(chrono.tps=e.tps,chrono.runtime=e.runtime),chrono.el.innerHTML=Math.floor(chrono.tps)+"s",chrono.el.classList.remove("pulse","warning_color"),chrono.start=!0,requestAnimationFrame(runVotes)}function endVoting(){console.log("end?"),chrono.pause=Date.now(),chrono.el.classList.remove("pulse","warning_color"),modal("√†_vot√©"),console.log("end!",chrono.pause)}zones.addEventListener("pointerdown",this.handlePointerDown),zones.addEventListener("pointermove",this.handlePointerMove),zones.addEventListener("pointerup",this.handlePointerUp);const modals={bienvenue:{content:'<h2>Bienvenue !</h2>\n            <button id="d√©marrer">D√©marrer</button>',"d√©marrer":function(){console.log("d√©marrer"),startVoting()}},"√†_vot√©":{content:function(){return store(chrono.init),localStorage.setItem("onGoingVote",""),localStorage.setItem("chrono"+chrono.init,""),chrono.init="",`<h2>Bien jou√© !</h2><p>\n            ${report()}</p>\n            <button id="mail">Envoyer les r√©sultats ?</button><br>\n            <button id="rejouer">Rejouer üòÄ</button>`},mail:function(){console.log("sauver ",lesBallons),mail(mailReportTo,"R√©sultat de mon vote",`${report()}`),0==voting.votes.length&&localStorage.clear()},rejouer:function(){location.reload()}},relance:{content:function(){store(chrono.init);let o,e=chrono.tps;return o=0==e?"Le temps est √©coul√©!":"Plus que "+Math.ceil(e)+" secondes",`<h2>${o}</h2>\n            <p>Il reste ${voting.votes.length} ballons.</p>\n            <button id="finir">Finir!</button>\n            <p>Ou ...</p>\n            <button id="mail">Envoyer les r√©sultats ?</button><br>\n            `},finir:function(){chrono.pause="",chrono.tps=chrono.tps||2.5*voting.votes.length,store(chrono.init),startVoting(chrono.tps)},mail:function(){console.log("sauver ",lesBallons),mail(mailReportTo,"R√©sultat de mon vote",`${report()}`),0==voting.votes.length&&localStorage.clear()}},Merci:{content:"<h2>Merci</h2>\n            <p>votre gestionnaire de courriel va s'ouvrir pour envoyer vos r√©sultats.<br>Merci d'avoir voter</p>\n            <button id=\"rejouer\">Rejouer ?</button>",rejouer:function(){location.reload()}}};function modal(o){const e=document.getElementById("modalsContainer");e.innerHTML="";const n=modals[o],t=document.createElement("div");t.id=o,t.classList.add("modal-content"),t.innerHTML="function"==typeof n.content?n.content():n.content,e.appendChild(t),e.classList.remove("hide"),t.addEventListener("click",(function(o){n[o.target.id]&&(event.stopPropagation(),e.classList.add("hide"),e.innerHTML="",n[o.target.id]())}))}function mail(o,e,n){window.open(`mailto:${o}?subject=${encodeURIComponent(e)}&body=${encodeURIComponent(n)}`),modal("Merci")}function report(){let o="‚è± "+Math.round(chrono.runtime)+"s.\r\nüéà üëç : "+JSON.stringify(keep.votes)+"\r\nüéà üëé : "+JSON.stringify(bin.votes);return voting.votes.length>0&&(o+="\r\nüéà ü§î : "+JSON.stringify(voting.votes)),o}function store(o=chrono.init||Date.now()){return localStorage.setItem("onGoingVote",o),localStorage.setItem(o,JSON.stringify(lesBallons)),localStorage.setItem("chrono"+chrono.init,JSON.stringify(chrono)),storedBallons=lesBallons,o}function inStore(o,e=localStorage.getItem("onGoingVote")){return storedBallons?.length>0||(storedBallons=JSON.parse(localStorage.getItem(e))),storedBallons?.find((e=>e.id==o))}document.getElementById("chrono").addEventListener("click",(()=>pauseVoting())),document.addEventListener("DOMContentLoaded",(function(){["image1.jpg","image2.jpg","image3.png","image4.png","image5.png","image6.png","image7.png"].forEach(((o,e)=>{lesBallons[e]=new Ballon(o,o)})),addEventListener("visibilitychange",(o=>{document.getElementById("modalsContainer").classList.contains("hide")&&pauseVoting()})),modal("bienvenue")}));


    </script>
</body>
</html>